<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">
<title>Derivatives</title>
</head>
<body>
<div id="content">
<div id="sidebar"><div class="sidebarblock"><h3>Useful</h3><ul><li><b>Derivatives</b></li><li><a href="geometry-and-trig.html">Geometry and Trig</a></li><li><a href="numbertheory.html">Number Theory</a></li></ul></div><div class="sidebarblock"><h3>Kinda fun</h3><ul><li><a href="integrals.html">Integrals</a></li><li><a href="more-integrals.html">More Integrals</a></li></ul></div><div class="sidebarblock"><h3>Mathy</h3><ul><li><a href="more-derivatives.html">More Derivatives</a></li><li><a href="more-geometry-and-trig.html">More Geometry and Trig</a></li><li><a href="explog.html">Exponent Functions and Logarithms</a></li></ul></div><div class="sidebarblock"><h3>Mind-blowing</h3><ul><li><a href="taylor.html">Taylor Polynomials</a></li><li><a href="eulerformula.html">Euler's Formula</a></li></ul></div><div class="sidebarblock"><h3>Other stuff</h3><ul><li><a href="basics.html">The Basics</a></li><li><a href="graphs.html">Common Graphs</a></li><li><a href="summary.html">Summary</a></li></ul><h3><a href="index.html">Back to front page</a></h3></div></div>
<h1 id="derivatives">Derivatives<a class="headerlink" href="#derivatives" title="Link to this title">¶</a></h1><p>Derivatives are one of my favorite things in math. At first they seem
like calculating their values will be quite complicated, but it turns
out to be surprisingly easy.</p>

<p>Derivatives are also not useless gibberish isolated from real life. There's a
practical demonstration game at the end of the chapter, and we can use them in
surprisingly many places like <a href="taylor.html">implementing our own sin function</a>.
If you have no idea what sin is that's not a problem, and you don't need it for
learning derivatives.</p>

<div class="box graybox"><p>This chapter starts with some boring stuff, but we need it for fun
stuff. Try to read patiently.
</p>

</div><h2 id="limits">Limits<a class="headerlink" href="#limits" title="Link to this title">¶</a></h2><p>Things like <img class="inlinemath" src="math/e79208a155b9fba922dec6f01012e023.png" /> seem to be <img class="inlinemath" src="math/c81e728d9d4c2f636f067f89cc14862c.png" /> with any <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" />. But there's one
exception: if <img class="inlinemath" src="math/e11729b0b65ecade3fc272548a3883fc.png" />, then <img class="inlinemath" src="math/e79208a155b9fba922dec6f01012e023.png" /> is <img class="inlinemath" src="math/8b9d8d4766e2abc43d0f572d2a9edba7.png" /> and thus not
defined.</p>

<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span><span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #40a070">2</span><span style="color: #666666">*</span><span style="color: #40a070">123</span><span style="color: #666666">/</span><span style="color: #40a070">123</span>
<span style="color: #888888">2.0</span>
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #40a070">2</span><span style="color: #666666">*</span><span style="color: #40a070">0</span><span style="color: #666666">/</span><span style="color: #40a070">0</span>
<span style="color: #0044DD">Traceback (most recent call last):</span>
  File <span style="color: #007020">&quot;&lt;stdin&gt;&quot;</span>, line <span style="color: #40a070">1</span>, in &lt;module&gt;
<span style="color: #FF0000">ZeroDivisionError</span>: division by zero
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #40a070">2</span><span style="color: #666666">*</span><span style="color: #40a070">0.00000001</span><span style="color: #666666">/</span><span style="color: #40a070">0.00000001</span>
<span style="color: #888888">2.0</span>
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #40a070">2</span><span style="color: #666666">*</span>(<span style="color: #666666">-</span><span style="color: #40a070">0.00000001</span>)<span style="color: #666666">/</span>(<span style="color: #666666">-</span><span style="color: #40a070">0.00000001</span>)
<span style="color: #888888">2.0</span>
</pre></div>
<p>No matter how near zero <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" /> is we get 2, even if <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" /> is negative. In
these cases, mathematicians say that
<img class="inlinemath" src="math/548e78554c5048acec7450b85a998151.png" />. Here lim means
that we take the <i>limit</i> as <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" /> goes to 0. We get <img class="inlinemath" src="math/8b9d8d4766e2abc43d0f572d2a9edba7.png" /> if we try
to do <img class="inlinemath" src="math/b59436751a0f85be782577e5451e5b94.png" />, but the limit still exists.</p>

<p>The limit does not exist if we get something like <img class="inlinemath" src="math/262e8067abc6ee8ec91bae4791deb4e5.png" /> or
<img class="inlinemath" src="math/38651be9fe9075037cf34de2b76b9aaa.png" /> as opposed to <img class="inlinemath" src="math/8b9d8d4766e2abc43d0f572d2a9edba7.png" />. See <a href="https://youtu.be/BRRolKTlF6Q?t=2m57s">this
video</a> for a really nice example
that also shows why.</p>

<p>We can also do things like this:</p>

<p><img src="math/f508b456188fe58bcdc8a064621df7bc.png" class="blockmath" /></p><p>I won't list all the things we can do to limits and why because the
rules are quite straight-forward and the why part is boring.</p>

<h2 id="slopes">Slopes<a class="headerlink" href="#slopes" title="Link to this title">¶</a></h2><p>A <i>difference</i> means how much a value changes. For example, if the value of <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" />
is first 5 and then we change it to 6, <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" /> changes by <img class="inlinemath" src="math/9e48412271eff0650ed355cbedce7457.png" />. Here
<img class="inlinemath" src="math/967878d1da852d4b07a961e3168b0fff.png" /> is the Greek delta letter, so if someone's code has a variable named
<code>deltax</code> it means this.</p>

<p id="slope">Let's draw a graph of something like <img class="inlinemath" src="math/4a8fccb45ff2a0ad548464d92965d3b3.png" />:
</p>

<p><img class="asymptote" src="asymptote/658b8e18cb886d602ec57f584063b949.png" /></p><p>For example, at <img class="inlinemath" src="math/5870bb658ee9e8a6900c138365d64c80.png" /> we know that <img class="inlinemath" src="math/33a88fa3fde50b0440190113c0bbd932.png" />.</p>

<p>Let's calculate the <b>slope</b> of this line:</p>

<p><img src="math/5743a8dae628a8aa3cae179d5208a364.png" class="blockmath" /></p><p>The bigger the slope, the faster the line goes up, so the slope describes the
"<b>growing speed</b>" or "<b>changing speed</b>". I used the <img class="inlinemath" src="math/90cbc22edf225adf8a68974f51227f05.png" /> points <img class="inlinemath" src="math/ec6014ffc3d92709aa6a4fea11bb3788.png" />
and <img class="inlinemath" src="math/711e7c26ecc6a8998409e882e5d51384.png" /> when calculating the slope, but you should get the same slope with
any pair of points chosen from the line because the height grows at the same
speed everywhere.</p>

<h2 id="what-is-a-derivative">What is a derivative?<a class="headerlink" href="#what-is-a-derivative" title="Link to this title">¶</a></h2><img class="asymptote" src="asymptote/43594100434e615b4b3437202c444388.png" style="float:right;" /><p>What if we could extend this slope thing to curvy graphs? At first sight it
might seem like we won't get a useful growing speed out of this because we get
different slopes depending on which points we choose as shown in the image at
right.</p>

<p>But what if we try to get the growing speed at some specific point, like
<img class="inlinemath" src="math/62e62b09682343672422866bb5bbf021.png" />
instead of a plain <img class="inlinemath" src="math/d87922a765f12f89c3c4acbaaf5e468c.png" />? Let's see what we get
from a <img class="inlinemath" src="math/7c1c9491ba7c6e8d6d2cfa82e39b22ca.png" /> graph where <img class="inlinemath" src="math/8fa14cdd754f91cc6554c9e71929cce7.png" /> is a function:</p>

<p><img class="asymptote" src="asymptote/850c13f0c13e3b03f1e0b31c7c4a47d0.png" /></p><p>Based on the image, if we take the length of the vertical <img class="inlinemath" src="math/a85f5dcfe160d24aba738b5a4cd06278.png" />
line and take off the length of the <img class="inlinemath" src="math/50bbd36e1fd2333108437a2ca378be62.png" /> line, we're left with just
<img class="inlinemath" src="math/7f5a0c1aa836580b7c14bcd90384f9c9.png" />. So <img class="inlinemath" src="math/ee5c9d2768444130ea3dd559ac8dbc0d.png" />:</p>

<p><img src="math/544f2fd514e8e7e23312a0488fb2c45e.png" class="blockmath" /></p><p>I finished by replacing <img class="inlinemath" src="math/b56546a86ab832a9b2a5b15f96519319.png" /> with <img class="inlinemath" src="math/2510c39011c5be704182423e3a695e91.png" /> because <img class="inlinemath" src="math/2510c39011c5be704182423e3a695e91.png" /> is easier and
faster to write than <img class="inlinemath" src="math/b56546a86ab832a9b2a5b15f96519319.png" />.</p>

<p>This "growing speed at x" value is known as <b>the derivative</b> of <img class="inlinemath" src="math/8fa14cdd754f91cc6554c9e71929cce7.png" />.
Sometimes the derivative doesn't exist, but most functions you'll come
across have the derivative. <a href="more-derivatives.html#which-functions-have-derivatives">Click
here</a> if you want to
know more.</p>

<div class="box graybox"><p>At this point you're probably feeling like this is just some
theorethical gibberish that has nothing to do with real life, but
that's not the case. Keep reading.
</p>

</div><p><a href="graphs.html#parabolas">The graph <img class="inlinemath" src="math/6e3935bb1907e05aef6649527518e040.png" /> is a parabola.</a>
Let's find the derivative of <img class="inlinemath" src="math/32f5240d0dbf2ccbe75ef7f8ef2015e0.png" /> by plugging in <img class="inlinemath" src="math/d271cedde6675e55152d3c7a4236f775.png" /> to the lim
thing we ended up with:</p>

<div class="floatingbox"><h2> Handy thing: <img class="inlinemath" src="math/838cec74357a4c7c5a4066b808f3b8c9.png" /></h2><p>Proof:</p>

<p><img src="math/ddcbae6858f01dea09f1b9c724ebd03d.png" class="blockmath" /></p></div><p><img src="math/58fcace29f5a876dcfb86021eaacf58e.png" class="blockmath" /></p><img class="asymptote" src="asymptote/70d42219b1c46cc9f2f1a3ae567da8ef.png" style="float:right;" /><p>I think this is cool. We started with a complicated-looking thing but finally
we arrived at just <img class="inlinemath" src="math/2204c2b4d60ae2fd5279ec54cfaed2a4.png" />. What's more, the <img class="inlinemath" src="math/2204c2b4d60ae2fd5279ec54cfaed2a4.png" /> is not just a random value we
got out of a spooky calculation; for example, at <img class="inlinemath" src="math/566162f3afaf9f5f67e7d7ca7a4b424e.png" /> the derivative is
<img class="inlinemath" src="math/a516b4ec389fe440150f7c6412631ab8.png" />, so if we draw a straight line that barely touches <img class="inlinemath" src="math/6e3935bb1907e05aef6649527518e040.png" /> at
<img class="inlinemath" src="math/566162f3afaf9f5f67e7d7ca7a4b424e.png" /> its slope will also be 4 like in the image at right.</p>

<p>You can also find the derivative of the <img class="inlinemath" src="math/45046de61b285009b23590450000d87f.png" /> example we looked at earlier,
and turns out that it's 2, just like the slope was. This makes sense because
derivatives are like slopes but they also work with curvy things, and there's no
difference between a slope and a derivative of a straight line.</p>

<div class="box graybox"><p>The derivative <img class="inlinemath" src="math/77e1c527f603347ff0967b6be96f1b24.png" />
is often written as <img class="inlinemath" src="math/3baffd623d24688b6229e8808f4dd24a.png" />. Historically <img class="inlinemath" src="math/8e7dd5d3e76aa952e21999a5537dcffb.png" /> and <img class="inlinemath" src="math/acd2b09d39705a84bff035c18c9faea9.png" /> were
infinitely tiny changes of <img class="inlinemath" src="math/415290769594460e2e485922904f345d.png" /> and <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" />, but nowadays limits are
preferred over "infinitely small numbers".</p>

<p>It's also common to write <img class="inlinemath" src="math/7bdae2eac1d9ea96203e434aa509bbe9.png" /> instead of <img class="inlinemath" src="math/3baffd623d24688b6229e8808f4dd24a.png" />,
although it doesn't make much sense because <img class="inlinemath" src="math/8e7dd5d3e76aa952e21999a5537dcffb.png" /> doesn't mean <img class="inlinemath" src="math/8277e0910d750195b448797616e091ad.png" /> times <img class="inlinemath" src="math/415290769594460e2e485922904f345d.png" />.
Another common style is to put a single quote after a function name, like
<img class="inlinemath" src="math/e3e396b27470ebc2f29600ab5e1b8d3e.png" />.</p>

<p>Sometimes programmers write <code>dy</code> when they really mean <code>deltay</code>.
It doesn't really make sense either, but <code>dy</code> is much less typing
than <code>deltay</code>.
</p>

</div><h2 id="faster">Faster!<a class="headerlink" href="#faster" title="Link to this title">¶</a></h2><p>Let's say that you want to calculate something like this:</p>

<p><img src="math/2fe7fd6a1b19e0df69a1154e39f489f4.png" class="blockmath" /></p><p>That would be a horribly complicated calculation with the <img class="inlinemath" src="math/6fc219cdeba331e561d143441aa359eb.png" /> thing.
Let's be a bit more clever.</p>

<p>We have a bunch of things with <img class="inlinemath" src="math/26b17225b626fb9238849fd60eabdf60.png" /> and <img class="inlinemath" src="math/336d5ebc5436534e61d16e63ddfca327.png" /> in between, so maybe we could
deal with them somehow? Let's say that we want to find the derivative of
<img class="inlinemath" src="math/f070deff5c0629450c5a975b58c3c33a.png" /> where <img class="inlinemath" src="math/8fa14cdd754f91cc6554c9e71929cce7.png" /> and <img class="inlinemath" src="math/b2f5ff47436671b6e533d8dc3614845d.png" /> can be any functions (as long as the
derivative exists). They could be for example <img class="inlinemath" src="math/27951896440f1f87773079e66afc3ea5.png" /> and
<img class="inlinemath" src="math/a623a9aa12f51bf5ab3f5f20ca4cb14c.png" />, but let's see what we get if we don't plug in any values:</p>

<p><img src="math/8328a5a4e52f08e816d1aaa809148068.png" class="blockmath" /></p><p>That's quite nice! So if we want to find the derivative of a bunch of
things added together we can just find derivatives of each thing one by
one. The same thing also works with <img class="inlinemath" src="math/336d5ebc5436534e61d16e63ddfca327.png" /> instead of <img class="inlinemath" src="math/26b17225b626fb9238849fd60eabdf60.png" />·</p>

<p>We can actually take a step further and find the derivative of <img class="inlinemath" src="math/59af385f17bb6c55092f1a8295664057.png" />
where <img class="inlinemath" src="math/4a8a08f09d37b73795649038408b5f33.png" /> is any constant, e.g. <img class="inlinemath" src="math/1679091c5a880faf6fb5e6087eb1b2dc.png" />:</p>

<p><img src="math/e75e679e759823c22ae10f5454f85f38.png" class="blockmath" /></p><p>We need a couple more things: <img class="inlinemath" src="math/4000d250bd0b459c35ad3e4c15be4fb0.png" /> because
<img class="inlinemath" src="math/53086fa5163f3e480d88e44f47309408.png" />, and
<img class="inlinemath" src="math/f9c4786fe3ccde95486b27617a82ed28.png" /> because <img class="inlinemath" src="math/4a8a08f09d37b73795649038408b5f33.png" /> never changes regardless of the value of <img class="inlinemath" src="math/9dd4e461268c8034f5c8564e155c67a6.png" />
and <img class="inlinemath" src="math/3cda97b8d2acf9619faa00c905e7c113.png" />. You can also use the definition of derivative to show that
these work.</p>

<p>So, with all that we can calculate the derivative easily:</p>

<p><img src="math/ba679bfb28627d5b515103b235b4192c.png" class="blockmath" /></p><div class="box graybox"><h2> See Also</h2><p>The summary page has a derivative section with <a href="summary.html#derivative-rules">many more
rules</a>. You may need them if you want
to find derivatives of different functions than the functions in
this chapter.
</p>

</div><p>You can also use a nice symbolic calculation library, like Python's
<a href="http://www.sympy.org">sympy</a> (can be installed with pip):</p>

<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span><span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #007020; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sympy</span> <span style="color: #007020; font-weight: bold">import</span> <span style="color: #666666">*</span>
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>init_printing()
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>x <span style="color: #666666">=</span> Symbol(<span style="color: #4070a0">&#39;x&#39;</span>)
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>diff(x<span style="color: #666666">**</span><span style="color: #40a070">2</span>, x)
<span style="color: #888888">2⋅x</span>
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>diff(<span style="color: #40a070">6</span> <span style="color: #666666">*</span> x<span style="color: #666666">**</span><span style="color: #40a070">2</span> <span style="color: #666666">+</span> <span style="color: #40a070">7</span><span style="color: #666666">*</span>x <span style="color: #666666">-</span> <span style="color: #40a070">123</span>, x)
<span style="color: #888888">12⋅x + 7</span>
</pre></div>
<p>Here "diff" is short for "differenciate", and it means finding a derivative.</p>

<p>Libraries like sympy are also useful for doing long and messy calculations like
the one we did above:</p>

<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span><span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">f</span>(x):
<span style="color: #c65d09; font-weight: bold">... </span>    <span style="color: #007020; font-weight: bold">return</span> x<span style="color: #666666">**</span><span style="color: #40a070">2</span>
<span style="color: #c65d09; font-weight: bold">...</span>
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>h <span style="color: #666666">=</span> Symbol(<span style="color: #4070a0">&#39;h&#39;</span>)
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>(f(x<span style="color: #666666">+</span>h)<span style="color: #666666">-</span>f(x))<span style="color: #666666">/</span>h
<span style="color: #888888">   2          2</span>
<span style="color: #888888">- x  + (h + x)</span>
<span style="color: #888888">───────────────</span>
<span style="color: #888888">       h</span>
<span style="color: #c65d09; font-weight: bold">&gt;&gt;&gt; </span>simplify((f(x<span style="color: #666666">+</span>h)<span style="color: #666666">-</span>f(x))<span style="color: #666666">/</span>h)
<span style="color: #888888">h + 2⋅x</span>
</pre></div>
<h2 id="example-smooth-jumps">Example: Smooth Jumps<a class="headerlink" href="#example-smooth-jumps" title="Link to this title">¶</a></h2><p>Let's say you're making a game where a player can jump over something. If the
player moves right at a steady speed, which of these jumps looks best?</p>

<p><img class="asymptote" src="asymptote/7e9197d1a759d35761b51c123fd5416b.png" /></p><p>The answer is obvious – the rightmost jump looks best. It's time to figure out
how to make games with jumps like that.</p>

<p>Let's say that <img class="inlinemath" src="math/e358efa489f58062f10dd7316b65649e.png" /> is time and <img class="inlinemath" src="math/2510c39011c5be704182423e3a695e91.png" /> is the height of our player, so we get this
graph:</p>

<p><img class="asymptote" src="asymptote/fc88711b46cb5bd2b1dca7e1eba9278a.png" /></p><p><a href="graphs.html#parabolas">This graph looks like a parabola, so its equation is <img class="inlinemath" src="math/3f43ec57439b2a949c6fd711c4779e26.png" />
where <img class="inlinemath" src="math/0cc175b9c0f1b6a831c399e269772661.png" />, <img class="inlinemath" src="math/92eb5ffee6ae2fec3ad71c777531578f.png" /> and <img class="inlinemath" src="math/4a8a08f09d37b73795649038408b5f33.png" /> are constants.</a> The
changing speed of height is the falling speed. Let's call that <img class="inlinemath" src="math/9e3669d19b675bd57058fd4664205d2a.png" /> like
velocity.</p>

<p><img src="math/5c051d833f0e5dafc419cbd7e4b8af96.png" class="blockmath" /></p><p>On the other hand, the changing speed of velocity is the acceleration caused by
gravity. Let's call that <img class="inlinemath" src="math/b2f5ff47436671b6e533d8dc3614845d.png" />.</p>

<p><img src="math/86259fdb69bddaabfefcba3c9339d919.png" class="blockmath" /></p><p>Note how the <img class="inlinemath" src="math/e358efa489f58062f10dd7316b65649e.png" /> disappeared and we're left with just the constant <img class="inlinemath" src="math/e36314e624d2b2ca257e1f1ecb381f93.png" />. This
makes sense because the gravity is always the same, no matter what time it is.</p>

<p>This Python program...</p>

<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span>height <span style="color: #666666">=</span> <span style="color: #40a070">0</span>
velocity <span style="color: #666666">=</span> <span style="color: #40a070">10</span>
gravity <span style="color: #666666">=</span> <span style="color: #40a070">2</span>

<span style="color: #007020; font-weight: bold">while</span> height <span style="color: #666666">&gt;=</span> <span style="color: #40a070">0</span>:
    <span style="color: #007020">print</span>(<span style="color: #4070a0">&#39; &#39;</span><span style="color: #666666">*</span>height <span style="color: #666666">+</span> <span style="color: #4070a0">&#39;O&#39;</span>)
    height <span style="color: #666666">+=</span> velocity
    velocity <span style="color: #666666">-=</span> gravity
</pre></div>
<p>...prints this awesome parabola:</p>

<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span>O
          O
                  O
                        O
                            O
                              O
                              O
                            O
                        O
                  O
          O
O
</pre></div>
<p>You can use similar code for doing jumps in games. Here's a demo created with
my <a href="https://github.com/Akuli/math-tutorial/blob/master/canvaswrapper.js">canvaswrapper.js</a> script. Click it and use arrow keys to move the ball.</p>

<script type="text/javascript" src="canvaswrapper.js"></script><canvas id="canvas1" width="600" height="400" tabindex="1"></canvas><script>var screen = new CanvasWrapper('canvas1');

const GRAVITY = 1.5;
var ball = {
  x: screen.width/2,    // centered
  height: 0,            // distance from bottom of screen to ball's bottom
  velocity: 0,          // positive means up
  velocityMax: 30,      // velocity immediately after a jump
  sidewayMovement: 0,   // -1 is left, +1 right
  sidewaySpeed: 10,
  radius: 30,
};


runRepeatedly(function() {
  screen.fill('black');
  screen.drawCircle(ball.x, screen.height-ball.height-ball.radius,
                    ball.radius, 'white');

  ball.x += ball.sidewayMovement * ball.sidewaySpeed;
  ball.height += ball.velocity;
  ball.velocity -= GRAVITY;

  if (ball.height < 0) {
    // ball hits the ground
    ball.height = 0;
    ball.velocity = 0;
  }

  screen.getEvents().forEach(evt => {
    if (evt.type == 'keydown') {
      if (evt.key == 'ArrowLeft') {
        ball.sidewayMovement = -1;
      } else if (evt.key == 'ArrowRight') {
        ball.sidewayMovement = 1;
      } else if (evt.key == 'ArrowUp') {
        ball.velocity = ball.velocityMax;
      }
    } else if (evt.type == 'keyup' && (
          (evt.key == 'ArrowLeft' && ball.sidewayMovement == -1) ||
          (evt.key == 'ArrowRight' && ball.sidewayMovement == 1))) {
      // cancel the previous ArrowLeft or ArrowRight press
      ball.sidewayMovement = 0;
    }
  });
});
</script><p>Here's the code:</p><div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span><span style="color: #007020; font-weight: bold">var</span> screen <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">new</span> CanvasWrapper(<span style="color: #4070a0">&#39;canvas1&#39;</span>);

<span style="color: #007020; font-weight: bold">const</span> GRAVITY <span style="color: #666666">=</span> <span style="color: #40a070">1.5</span>;
<span style="color: #007020; font-weight: bold">var</span> ball <span style="color: #666666">=</span> {
  x<span style="color: #666666">:</span> screen.width<span style="color: #666666">/</span><span style="color: #40a070">2</span>,    <span style="color: #60a0b0; font-style: italic">// centered</span>
  height<span style="color: #666666">:</span> <span style="color: #40a070">0</span>,            <span style="color: #60a0b0; font-style: italic">// distance from bottom of screen to ball&#39;s bottom</span>
  velocity<span style="color: #666666">:</span> <span style="color: #40a070">0</span>,          <span style="color: #60a0b0; font-style: italic">// positive means up</span>
  velocityMax<span style="color: #666666">:</span> <span style="color: #40a070">30</span>,      <span style="color: #60a0b0; font-style: italic">// velocity immediately after a jump</span>
  sidewayMovement<span style="color: #666666">:</span> <span style="color: #40a070">0</span>,   <span style="color: #60a0b0; font-style: italic">// -1 is left, +1 right</span>
  sidewaySpeed<span style="color: #666666">:</span> <span style="color: #40a070">10</span>,
  radius<span style="color: #666666">:</span> <span style="color: #40a070">30</span>,
};


runRepeatedly(<span style="color: #007020; font-weight: bold">function</span>() {
  screen.fill(<span style="color: #4070a0">&#39;black&#39;</span>);
  screen.drawCircle(ball.x, screen.height<span style="color: #666666">-</span>ball.height<span style="color: #666666">-</span>ball.radius,
                    ball.radius, <span style="color: #4070a0">&#39;white&#39;</span>);

  ball.x <span style="color: #666666">+=</span> ball.sidewayMovement <span style="color: #666666">*</span> ball.sidewaySpeed;
  ball.height <span style="color: #666666">+=</span> ball.velocity;
  ball.velocity <span style="color: #666666">-=</span> GRAVITY;

  <span style="color: #007020; font-weight: bold">if</span> (ball.height <span style="color: #666666">&lt;</span> <span style="color: #40a070">0</span>) {
    <span style="color: #60a0b0; font-style: italic">// ball hits the ground</span>
    ball.height <span style="color: #666666">=</span> <span style="color: #40a070">0</span>;
    ball.velocity <span style="color: #666666">=</span> <span style="color: #40a070">0</span>;
  }

  screen.getEvents().forEach(evt =&gt; {
    <span style="color: #007020; font-weight: bold">if</span> (evt.type <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;keydown&#39;</span>) {
      <span style="color: #007020; font-weight: bold">if</span> (evt.key <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;ArrowLeft&#39;</span>) {
        ball.sidewayMovement <span style="color: #666666">=</span> <span style="color: #666666">-</span><span style="color: #40a070">1</span>;
      } <span style="color: #007020; font-weight: bold">else</span> <span style="color: #007020; font-weight: bold">if</span> (evt.key <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;ArrowRight&#39;</span>) {
        ball.sidewayMovement <span style="color: #666666">=</span> <span style="color: #40a070">1</span>;
      } <span style="color: #007020; font-weight: bold">else</span> <span style="color: #007020; font-weight: bold">if</span> (evt.key <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;ArrowUp&#39;</span>) {
        ball.velocity <span style="color: #666666">=</span> ball.velocityMax;
      }
    } <span style="color: #007020; font-weight: bold">else</span> <span style="color: #007020; font-weight: bold">if</span> (evt.type <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;keyup&#39;</span> <span style="color: #666666">&amp;&amp;</span> (
          (evt.key <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;ArrowLeft&#39;</span> <span style="color: #666666">&amp;&amp;</span> ball.sidewayMovement <span style="color: #666666">==</span> <span style="color: #666666">-</span><span style="color: #40a070">1</span>) <span style="color: #666666">||</span>
          (evt.key <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;ArrowRight&#39;</span> <span style="color: #666666">&amp;&amp;</span> ball.sidewayMovement <span style="color: #666666">==</span> <span style="color: #40a070">1</span>))) {
      <span style="color: #60a0b0; font-style: italic">// cancel the previous ArrowLeft or ArrowRight press</span>
      ball.sidewayMovement <span style="color: #666666">=</span> <span style="color: #40a070">0</span>;
    }
  });
});
</pre></div>
</div>
</body>
</html>
